<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MT5 Real-Time Trading Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                MT5 Real-Time Trading Dashboard
                <span id="statusIndicator" class="status disconnected">DISCONNECTED</span>
            </h1>

            <div class="controls">
                <div class="control-group">
                    <label for="symbolSelect">Symbol:</label>
                    <select id="symbolSelect">
                        <option value="PainX 400">PainX 400</option>
                        <option value="PainX 600">PainX 600</option>
                        <option value="PainX 800">PainX 800</option>
                        <option value="PainX 999">PainX 999</option>
                        <option value="GainX 400">GainX 400</option>
                        <option value="GainX 600">GainX 600</option>
                        <option value="GainX 800">GainX 800</option>
                        <option value="GainX 999">GainX 999</option>
                        <option value="FX Vol 20">FX Vol 20</option>
                        <option value="FX Vol 40">FX Vol 40</option>
                        <option value="FX Vol 60">FX Vol 60</option>
                        <option value="FlipX 1">FlipX 1</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="timeframeSelect">Timeframe:</label>
                    <select id="timeframeSelect">
                        <option value="M1">M1 (1 Minute)</option>
                        <option value="M5">M5 (5 Minutes)</option>
                        <option value="M15">M15 (15 Minutes)</option>
                        <option value="M30">M30 (30 Minutes)</option>
                        <option value="H1">H1 (1 Hour)</option>
                        <option value="H4">H4 (4 Hours)</option>
                        <option value="D1">D1 (1 Day)</option>
                    </select>
                </div>
            </div>
        </header>

        <div class="grid">
            <div class="card">
                <div class="card-title">Current Bid</div>
                <div id="bidPrice" class="card-value">--</div>
                <div class="timestamp">Waiting for data...</div>
            </div>

            <div class="card">
                <div class="card-title">Current Ask</div>
                <div id="askPrice" class="card-value">--</div>
                <div class="timestamp">Waiting for data...</div>
            </div>

            <div class="card">
                <div class="card-title">Spread</div>
                <div id="spread" class="card-value">--</div>
                <div class="timestamp">Points</div>
            </div>

            <div class="card">
                <div class="card-title">Account Balance</div>
                <div id="balance" class="card-value">--</div>
                <div class="timestamp">USD</div>
            </div>

            <div class="card">
                <div class="card-title">Account Equity</div>
                <div id="equity" class="card-value">--</div>
                <div class="timestamp">USD</div>
            </div>

            <div class="card">
                <div class="card-title">Current Profit</div>
                <div id="profit" class="card-value">--</div>
                <div class="timestamp">USD</div>
            </div>
        </div>

        <div id="errorContainer"></div>

        <!-- Bot Status Panel -->
        <div class="bot-status-panel">
            <div class="bot-panel-title">
                ðŸ¤– Trading Bot Status - <span id="botSymbol">--</span>
                <span id="botBias" class="bias-indicator">--</span>
            </div>
            <div class="bot-grid">
                <div class="bot-card" id="painBuyCard">
                    <div class="bot-card-header">
                        <span class="bot-name">PAIN BUY</span>
                        <span class="bot-status" id="painBuyStatus">â—‹ IDLE</span>
                    </div>
                    <div class="bot-reasons" id="painBuyReasons">Waiting for conditions...</div>
                </div>
                <div class="bot-card" id="painSellCard">
                    <div class="bot-card-header">
                        <span class="bot-name">PAIN SELL</span>
                        <span class="bot-status" id="painSellStatus">â—‹ IDLE</span>
                    </div>
                    <div class="bot-reasons" id="painSellReasons">Waiting for conditions...</div>
                </div>
                <div class="bot-card" id="gainBuyCard">
                    <div class="bot-card-header">
                        <span class="bot-name">GAIN BUY</span>
                        <span class="bot-status" id="gainBuyStatus">â—‹ IDLE</span>
                    </div>
                    <div class="bot-reasons" id="gainBuyReasons">Waiting for conditions...</div>
                </div>
                <div class="bot-card" id="gainSellCard">
                    <div class="bot-card-header">
                        <span class="bot-name">GAIN SELL</span>
                        <span class="bot-status" id="gainSellStatus">â—‹ IDLE</span>
                    </div>
                    <div class="bot-reasons" id="gainSellReasons">Waiting for conditions...</div>
                </div>
            </div>
            <div class="bot-info-bar">
                <div class="bot-info-item">
                    <span class="bot-info-label">Trend:</span>
                    <span id="botTrend">--</span>
                </div>
                <div class="bot-info-item">
                    <span class="bot-info-label">M1 State:</span>
                    <span id="botM1State">--</span>
                </div>
                <div class="bot-info-item">
                    <span class="bot-info-label">Daily P/L:</span>
                    <span id="botDailyPL">$0.00</span>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">
                Price Chart - <span id="chartSymbol">--</span> (<span id="chartTimeframe">--</span>)
                <!-- <div class="trading-buttons">
                    <button id="buyBtn" class="trade-btn buy-btn">BUY</button>
                    <button id="sellBtn" class="trade-btn sell-btn">SELL</button>
                </div> -->
            </div>
            <div class="chart-controls">
                <label class="switch-label">
                    <input type="checkbox" id="toggleCandleWick" checked>
                    <span class="slider"></span>
                    <span class="label-text">Wick</span>
                </label>
                <label class="switch-label">
                    <input type="checkbox" id="toggleCandleBody" checked>
                    <span class="slider"></span>
                    <span class="label-text">Body</span>
                </label>
                <label class="switch-label">
                    <input type="checkbox" id="toggleClose">
                    <span class="slider"></span>
                    <span class="label-text">Close</span>
                </label>
                <label class="switch-label">
                    <input type="checkbox" id="toggleHigh">
                    <span class="slider"></span>
                    <span class="label-text">High</span>
                </label>
                <label class="switch-label">
                    <input type="checkbox" id="toggleLow">
                    <span class="slider"></span>
                    <span class="label-text">Low</span>
                </label>
                <label class="switch-label">
                    <input type="checkbox" id="toggleSnake">
                    <span class="slider"></span>
                    <span class="label-text">Snake</span>
                </label>
                <label class="switch-label">
                    <input type="checkbox" id="togglePurple">
                    <span class="slider"></span>
                    <span class="label-text">Purple</span>
                </label>
                <div class="period-separator"></div>
                <label class="period-control">
                    <span class="period-label">Snake Period:</span>
                    <input type="number" id="snakePeriod" min="10" max="500" value="100" step="1">
                </label>
                <label class="period-control">
                    <span class="period-label">Purple Period:</span>
                    <input type="number" id="purplePeriod" min="5" max="100" value="10" step="1">
                </label>
            </div>
            <canvas id="priceChart"></canvas>
        </div>

        <!-- Historical Chart Section -->
        <div class="historical-chart-section">
            <div class="historical-header">
                <div class="historical-title">Historical Chart Viewer</div>
                <div class="historical-controls">
                    <label>
                        Date: <input type="date" id="historicalDate" />
                    </label>
                    <label>
                        Start Time: <input type="time" id="historicalStartTime" value="00:00" />
                    </label>
                    <label>
                        End Time: <input type="time" id="historicalEndTime" value="23:59" />
                    </label>
                    <label>
                        Timeframe:
                        <select id="historicalTimeframe">
                            <option value="M1">M1</option>
                            <option value="M5">M5</option>
                            <option value="M15">M15</option>
                            <option value="M30">M30</option>
                            <option value="H1">H1</option>
                            <option value="H4">H4</option>
                            <option value="D1">D1</option>
                        </select>
                    </label>
                    <button id="loadHistoricalBtn" class="load-historical-btn">Load Historical Data</button>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">Historical Chart - <span id="historicalChartInfo">Select date and click Load</span></div>
                <div class="chart-controls">
                    <label class="switch-label">
                        <input type="checkbox" id="toggleHistoricalWick" checked>
                        <span class="slider"></span>
                        <span class="label-text">Wick</span>
                    </label>
                    <label class="switch-label">
                        <input type="checkbox" id="toggleHistoricalBody" checked>
                        <span class="slider"></span>
                        <span class="label-text">Body</span>
                    </label>
                    <label class="switch-label">
                        <input type="checkbox" id="toggleHistoricalClose">
                        <span class="slider"></span>
                        <span class="label-text">Close</span>
                    </label>
                    <label class="switch-label">
                        <input type="checkbox" id="toggleHistoricalHigh">
                        <span class="slider"></span>
                        <span class="label-text">High</span>
                    </label>
                    <label class="switch-label">
                        <input type="checkbox" id="toggleHistoricalLow">
                        <span class="slider"></span>
                        <span class="label-text">Low</span>
                    </label>
                    <label class="switch-label">
                        <input type="checkbox" id="toggleHistoricalSnake">
                        <span class="slider"></span>
                        <span class="label-text">Snake</span>
                    </label>
                    <label class="switch-label">
                        <input type="checkbox" id="toggleHistoricalPurple">
                        <span class="slider"></span>
                        <span class="label-text">Purple</span>
                    </label>
                </div>
                <canvas id="historicalChart"></canvas>
            </div>
        </div>

        <div class="signals-container">
            <div class="signals-header">
                <div class="signals-title">Trading Signals (Perfect Moments)</div>
                <button id="clearSignalsBtn" class="clear-signals-btn">Clear</button>
            </div>
            <div id="signalsListBox" class="signals-list">
                <div class="no-data">Waiting for signals...</div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Open Positions</div>
            <div id="positionsContainer">
                <div class="no-data">No open positions</div>
            </div>
        </div>
    </div>

    <!-- Load modules in correct order -->
    <script src="js/constants.js"></script>
    <script src="js/indicators.js"></script>
    <script src="js/chartConfig.js"></script>
    <script src="js/chartHelpers.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/botUI.js"></script>
    <script src="js/websocket.js"></script>
    <script src="dashboard.js"></script>

    <script>
        // Add bot_status message handler to websocket
        if (typeof WebSocketManager !== 'undefined') {
            const originalHandleMessage = WebSocketManager.prototype.handleMessage;
            WebSocketManager.prototype.handleMessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    if (data.type === 'bot_status' && window.updateBotStatus) {
                        window.updateBotStatus(data);
                    }
                } catch (e) {
                    // Continue to original handler
                }
                return originalHandleMessage.call(this, event);
            };
        }
    </script>
</body>
</html>
